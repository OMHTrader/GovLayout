<main class="wrap" style="padding-top:12px">
  <!-- Top controls (reuse your search/select if you like) -->
  <section class="row" style="margin-bottom:12px">
    <input id="search" placeholder="Search members, artifacts, companies…" />
    <select id="branch">
      <option value="">All branches</option>
      <option value="legislative">Legislative</option>
      <option value="executive">Executive</option>
      <option value="judicial">Judicial</option>
    </select>
  </section>

  <!-- Canvas row -->
  <section class="panel" style="overflow:hidden">
    <svg id="canvas" viewBox="0 0 1200 600" preserveAspectRatio="xMidYMid meet" style="width:100%;height:60vh">
      <!-- Columns guides -->
      <g id="cols" fill="none" stroke="rgba(255,255,255,.06)">
        <line x1="140" y1="0" x2="140" y2="600"/>
        <line x1="500" y1="0" x2="500" y2="600"/>
        <line x1="900" y1="0" x2="900" y2="600"/>
      </g>

      <!-- Column labels -->
      <g font-size="14" fill="#94a3b8">
        <text x="60"  y="30">Branches</text>
        <text x="520" y="30">Policies / Laws / Rulings</text>
        <text x="940" y="30">Public Companies</text>
      </g>

      <!-- Branch “buildings” -->
      <g id="branches">
        <!-- Capitol -->
        <g class="node branch" data-branch="legislative" transform="translate(60,70)">
          <rect width="160" height="70" rx="10" fill="#0b1222" stroke="#334155"/>
          <text x="80" y="42" text-anchor="middle" fill="#e5e7eb" font-weight="600">Capitol</text>
          <text x="80" y="60" text-anchor="middle" fill="#94a3b8" font-size="12">Legislative</text>
        </g>
        <!-- White House -->
        <g class="node branch" data-branch="executive" transform="translate(60,170)">
          <rect width="160" height="70" rx="10" fill="#0b1222" stroke="#334155"/>
          <text x="80" y="42" text-anchor="middle" fill="#e5e7eb" font-weight="600">White House</text>
          <text x="80" y="60" text-anchor="middle" fill="#94a3b8" font-size="12">Executive</text>
        </g>
        <!-- Supreme Court -->
        <g class="node branch" data-branch="judicial" transform="translate(60,270)">
          <rect width="160" height="70" rx="10" fill="#0b1222" stroke="#334155"/>
          <text x="80" y="42" text-anchor="middle" fill="#e5e7eb" font-weight="600">Supreme Court</text>
          <text x="80" y="60" text-anchor="middle" fill="#94a3b8" font-size="12">Judicial</text>
        </g>
      </g>

      <!-- Artifact cards (auto-laid out) -->
      <g id="artifacts"></g>

      <!-- Company cards (auto-laid out) -->
      <g id="companies"></g>

      <!-- Edges -->
      <g id="edges" fill="none" stroke="#3b82f6" stroke-opacity=".5"></g>
    </svg>
  </section>
</main>

<script>
(async function(){
  const data = await fetch('data.json').then(r=>r.json());

  // Basic vertical layout helpers
  const artX = 520, artY0 = 80, artDy = 90;
  const coX  = 940, coY0  = 80, coDy  = 70;

  // Index artifacts/companies for positions
  const art = data.artifacts.map((a,i)=>({ ...a, x: artX, y: artY0 + i*artDy }));
  const cos = data.companies.map((c,i)=>({ ...c, x: coX,  y: coY0  + i*coDy  }));

  const A = Object.fromEntries(art.map(a=>[a.id,a]));
  const C = Object.fromEntries(cos.map(c=>[c.id,c]));

  // Render artifacts
  const gA = document.getElementById('artifacts');
  gA.innerHTML = art.map(a => `
    <g class="node artifact" data-id="${a.id}" transform="translate(${a.x-160},${a.y-28})">
      <rect width="320" height="56" rx="10" fill="#0b1222" stroke="#334155"></rect>
      <text x="12" y="24" fill="#e5e7eb" font-weight="600">${a.short_title || a.title}</text>
      <text x="12" y="40" fill="#94a3b8" font-size="12">${a.type} • ${a.status || ''}</text>
    </g>
  `).join('');

  // Render companies
  const gC = document.getElementById('companies');
  gC.innerHTML = cos.map(c => `
    <g class="node company" data-id="${c.id}" transform="translate(${c.x-160},${c.y-22})">
      <rect width="320" height="44" rx="10" fill="#0b1222" stroke="#334155"></rect>
      <text x="12" y="28" fill="#e5e7eb" font-weight="600">${c.name}${c.ticker?` (${c.ticker})`:''}</text>
    </g>
  `).join('');

  // Render edges (artifact→company)
  const gE = document.getElementById('edges');
  function curve(x1,y1,x2,y2){
    const mx = (x1+x2)/2;
    return `M${x1},${y1} C ${mx},${y1} ${mx},${y2} ${x2},${y2}`;
  }
  gE.innerHTML = data.edges.artifact_company.map(e=>{
    const a=A[e.from], c=C[e.to]; if(!a||!c) return '';
    return `<path d="${curve(a.x+0, a.y, c.x-160, c.y)}" stroke-width="2" />`;
  }).join('');

  // Hover highlight (design demo)
  const svg = document.getElementById('canvas');
  svg.addEventListener('mouseover', e=>{
    const n = e.target.closest('.node'); if(!n) return;
    svg.style.setProperty('--fade','.2');
    document.querySelectorAll('#edges path').forEach(p=>p.style.opacity=.15);
  });
  svg.addEventListener('mouseout', e=>{
    svg.style.removeProperty('--fade');
    document.querySelectorAll('#edges path').forEach(p=>p.style.opacity=.5);
  });

  // Click trace: click an artifact to thicken its edges
  svg.addEventListener('click', e=>{
    const artNode = e.target.closest('.artifact');
    if(!artNode) return;
    const id = artNode.getAttribute('data-id');
    document.querySelectorAll('#edges path').forEach(p=>p.setAttribute('stroke-width','2'));
    data.edges.artifact_company.forEach((edge, i)=>{
      if(edge.from === id){
        const path = gE.children[i];
        if(path) path.setAttribute('stroke-width','4');
      }
    });
  });
})();
</script>
